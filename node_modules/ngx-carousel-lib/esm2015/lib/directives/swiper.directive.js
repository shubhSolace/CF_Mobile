/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, HostListener, ElementRef, Renderer2, Output, EventEmitter } from '@angular/core';
/** @type {?} */
const ZERO = 0.000000000001;
/** @type {?} */
const DIRECTION = {
    LEFT: 'left',
    RIGHT: 'right',
    UP: 'up',
    DOWN: 'down',
    NONE: 'none',
};
export class SwiperDirective {
    /**
     * @param {?} el
     * @param {?} renderer
     */
    constructor(el, renderer) {
        this.el = el;
        this.renderer = renderer;
        this.isDown = false;
        this.initialPosX = ZERO;
        this.initialPosY = ZERO;
        this.lastPosX = ZERO;
        this.lastPosY = ZERO;
        this.swipeDistanceX = ZERO;
        this.swipeDistanceY = ZERO;
        this.firstSwipeDate = Date.now();
        this.direction = DIRECTION.NONE;
        this.onSwipeRight = new EventEmitter();
        this.onSwipeLeft = new EventEmitter();
        this.onSwipeUp = new EventEmitter();
        this.onSwipeDown = new EventEmitter();
        this.onSwipe = new EventEmitter();
        this.onSwipeStart = new EventEmitter();
        this.onSwipeEnd = new EventEmitter();
        this.swipeLeft = new EventEmitter();
        this.swipeRight = new EventEmitter();
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * @param {?} event
     * @return {?}
     */
    getResultFromEvent(event) {
        /** @type {?} */
        let swipeFrameDistanceX = event.clientX - this.initialPosX - this.lastPosX;
        swipeFrameDistanceX = swipeFrameDistanceX < 30 ? swipeFrameDistanceX : 30;
        this.swipeDistanceX += swipeFrameDistanceX;
        /** @type {?} */
        let swipeFrameDistanceY = event.clientY - this.initialPosY - this.lastPosY;
        swipeFrameDistanceY = swipeFrameDistanceY < 30 ? swipeFrameDistanceY : 30;
        this.swipeDistanceY += swipeFrameDistanceY;
        this.lastPosX = event.clientX - this.initialPosX;
        this.lastPosY = event.clientY - this.initialPosY;
        /** @type {?} */
        const res = {
            velocityX: swipeFrameDistanceX,
            velocityY: swipeFrameDistanceY,
            isFinal: false,
            direction: this.direction,
            event: event,
        };
        return res;
    }
    /**
     * @param {?} event
     * @return {?}
     */
    swipeStart(event) {
        this.firstSwipeDate = Date.now();
        this.isDown = true;
        this.initialPosX = event.clientX;
        this.initialPosY = event.clientY;
        this.swipeDistanceX = ZERO;
        this.swipeDistanceY = ZERO;
        this.onSwipeStart.emit();
    }
    /**
     * @param {?} event
     * @return {?}
     */
    swipeEnd(event) {
        this.initialPosX = this.lastPosX = ZERO;
        this.initialPosY = this.lastPosY = ZERO;
        this.isDown = false;
        /** @type {?} */
        const res = {
            velocityX: 0,
            velocityY: 0,
            isFinal: !this.isDown,
        };
        this.onSwipeEnd.emit(res);
        this.swipeDistanceX = ZERO;
        this.swipeDistanceY = ZERO;
    }
    /**
     * @param {?} event
     * @return {?}
     */
    swipeMove(event) {
        /** @type {?} */
        const res = this.getResultFromEvent(event);
        if (res.velocityX > 0) {
            this.direction = DIRECTION.LEFT;
            this.onSwipeLeft.emit(res);
        }
        else if (res.velocityX < 0) {
            this.direction = DIRECTION.RIGHT;
            this.onSwipeRight.emit(res);
        }
        else if (res.velocityY > 0) {
            this.direction = DIRECTION.DOWN;
            this.onSwipeDown.emit(res);
        }
        else if (res.velocityY < 0) {
            this.direction = DIRECTION.UP;
            this.onSwipeUp.emit(res);
        }
        this.onSwipe.emit(res);
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onTouchStart(event) {
        /** @type {?} */
        const touch = event.touches[0] || event.changedTouches[0];
        this.swipeStart(touch);
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onMouseDown(event) {
        this.swipeStart(event);
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onMouseUp(event) {
        this.swipeEnd(event);
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onTouchEnd(event) {
        /** @type {?} */
        const touch = event.touches[0] || event.changedTouches[0];
        this.swipeEnd(touch);
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onMouseMove(event) {
        if (this.isDown) {
            this.swipeMove(event);
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onTouchMove(event) {
        /** @type {?} */
        const touch = event.touches[0] || event.changedTouches[0];
        this.swipeMove(touch);
    }
}
SwiperDirective.decorators = [
    { type: Directive, args: [{
                selector: '[swiper]',
                exportAs: 'swiper'
            },] }
];
/** @nocollapse */
SwiperDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 }
];
SwiperDirective.propDecorators = {
    onSwipeRight: [{ type: Output }],
    onSwipeLeft: [{ type: Output }],
    onSwipeUp: [{ type: Output }],
    onSwipeDown: [{ type: Output }],
    onSwipe: [{ type: Output }],
    onSwipeStart: [{ type: Output }],
    onSwipeEnd: [{ type: Output }],
    swipeLeft: [{ type: Output }],
    swipeRight: [{ type: Output }],
    onTouchStart: [{ type: HostListener, args: ['touchstart', ['$event'],] }],
    onMouseDown: [{ type: HostListener, args: ['mousedown', ['$event'],] }],
    onMouseUp: [{ type: HostListener, args: ['document:mouseup', ['$event'],] }],
    onTouchEnd: [{ type: HostListener, args: ['touchend', ['$event'],] }],
    onMouseMove: [{ type: HostListener, args: ['mousemove', ['$event'],] }],
    onTouchMove: [{ type: HostListener, args: ['touchmove', ['$event'],] }]
};
if (false) {
    /** @type {?} */
    SwiperDirective.prototype.isDown;
    /** @type {?} */
    SwiperDirective.prototype.initialPosX;
    /** @type {?} */
    SwiperDirective.prototype.initialPosY;
    /** @type {?} */
    SwiperDirective.prototype.lastPosX;
    /** @type {?} */
    SwiperDirective.prototype.lastPosY;
    /** @type {?} */
    SwiperDirective.prototype.swipeDistanceX;
    /** @type {?} */
    SwiperDirective.prototype.swipeDistanceY;
    /** @type {?} */
    SwiperDirective.prototype.firstSwipeDate;
    /** @type {?} */
    SwiperDirective.prototype.direction;
    /** @type {?} */
    SwiperDirective.prototype.onSwipeRight;
    /** @type {?} */
    SwiperDirective.prototype.onSwipeLeft;
    /** @type {?} */
    SwiperDirective.prototype.onSwipeUp;
    /** @type {?} */
    SwiperDirective.prototype.onSwipeDown;
    /** @type {?} */
    SwiperDirective.prototype.onSwipe;
    /** @type {?} */
    SwiperDirective.prototype.onSwipeStart;
    /** @type {?} */
    SwiperDirective.prototype.onSwipeEnd;
    /** @type {?} */
    SwiperDirective.prototype.swipeLeft;
    /** @type {?} */
    SwiperDirective.prototype.swipeRight;
    /**
     * @type {?}
     * @private
     */
    SwiperDirective.prototype.el;
    /**
     * @type {?}
     * @private
     */
    SwiperDirective.prototype.renderer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3dpcGVyLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1jYXJvdXNlbC1saWIvIiwic291cmNlcyI6WyJsaWIvZGlyZWN0aXZlcy9zd2lwZXIuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQVUsTUFBTSxlQUFlLENBQUM7O01BRXZHLElBQUksR0FBRyxjQUFjOztNQUNyQixTQUFTLEdBQUc7SUFDaEIsSUFBSSxFQUFHLE1BQU07SUFDYixLQUFLLEVBQUcsT0FBTztJQUNmLEVBQUUsRUFBRyxJQUFJO0lBQ1QsSUFBSSxFQUFHLE1BQU07SUFDYixJQUFJLEVBQUcsTUFBTTtDQUNkO0FBS0QsTUFBTSxPQUFPLGVBQWU7Ozs7O0lBcUJ4QixZQUNZLEVBQWMsRUFDZCxRQUFtQjtRQURuQixPQUFFLEdBQUYsRUFBRSxDQUFZO1FBQ2QsYUFBUSxHQUFSLFFBQVEsQ0FBVztRQXRCL0IsV0FBTSxHQUFHLEtBQUssQ0FBQztRQUNmLGdCQUFXLEdBQVcsSUFBSSxDQUFDO1FBQzNCLGdCQUFXLEdBQVcsSUFBSSxDQUFDO1FBQzNCLGFBQVEsR0FBVyxJQUFJLENBQUM7UUFDeEIsYUFBUSxHQUFXLElBQUksQ0FBQztRQUN4QixtQkFBYyxHQUFXLElBQUksQ0FBQztRQUM5QixtQkFBYyxHQUFXLElBQUksQ0FBQztRQUM5QixtQkFBYyxHQUFHLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUM1QixjQUFTLEdBQUcsU0FBUyxDQUFDLElBQUksQ0FBQztRQUVqQixpQkFBWSxHQUFzQixJQUFJLFlBQVksRUFBTyxDQUFDO1FBQzFELGdCQUFXLEdBQXNCLElBQUksWUFBWSxFQUFPLENBQUM7UUFDekQsY0FBUyxHQUFzQixJQUFJLFlBQVksRUFBTyxDQUFDO1FBQ3ZELGdCQUFXLEdBQXNCLElBQUksWUFBWSxF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Qjs7SUFDM0IsbUNBQXdCOztJQUN4QixtQ0FBd0I7O0lBQ3hCLHlDQUE4Qjs7SUFDOUIseUNBQThCOztJQUM5Qix5Q0FBNEI7O0lBQzVCLG9DQUEyQjs7SUFFM0IsdUNBQW9FOztJQUNwRSxzQ0FBbUU7O0lBQ25FLG9DQUFpRTs7SUFDakUsc0NBQW1FOztJQUNuRSxrQ0FBK0Q7O0lBQy9ELHVDQUFvRTs7SUFDcEUscUNBQWtFOztJQUNsRSxvQ0FBaUU7O0lBQ2pFLHFDQUFrRTs7Ozs7SUFHOUQsNkJBQXNCOzs7OztJQUN0QixtQ0FBMkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEaXJlY3RpdmUsIEhvc3RMaXN0ZW5lciwgRWxlbWVudFJlZiwgUmVuZGVyZXIyLCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgT25Jbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmNvbnN0IFpFUk8gPSAwLjAwMDAwMDAwMDAwMTtcbmNvbnN0IERJUkVDVElPTiA9IHtcbiAgTEVGVCA6ICdsZWZ0JyxcbiAgUklHSFQgOiAncmlnaHQnLFxuICBVUCA6ICd1cCcsXG4gIERPV04gOiAnZG93bicsXG4gIE5PTkUgOiAnbm9uZScsXG59O1xuQERpcmVjdGl2ZSh7XG4gICAgc2VsZWN0b3I6ICdbc3dpcGVyXScsXG4gICAgZXhwb3J0QXM6ICdzd2lwZXInXG59KVxuZXhwb3J0IGNsYXNzIFN3aXBlckRpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gICAgaXNEb3duID0gZmFsc2U7XG4gICAgaW5pdGlhbFBvc1g6IG51bWJlciA9IFpFUk87XG4gICAgaW5pdGlhbFBvc1k6IG51bWJlciA9IFpFUk87XG4gICAgbGFzdFBvc1g6IG51bWJlciA9IFpFUk87XG4gICAgbGFzdFBvc1k6IG51bWJlciA9IFpFUk87XG4gICAgc3dpcGVEaXN0YW5jZVg6IG51bWJlciA9IFpFUk87XG4gICAgc3dpcGVEaXN0YW5jZVk6IG51bWJlciA9IFpFUk87XG4gICAgZmlyc3RTd2lwZURhdGUgPSBEYXRlLm5vdygpO1xuICAgIGRpcmVjdGlvbiA9IERJUkVDVElPTi5OT05FO1xuXG4gICAgQE91dHB1dCgpIG9uU3dpcGVSaWdodDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgICBAT3V0cHV0KCkgb25Td2lwZUxlZnQ6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gICAgQE91dHB1dCgpIG9uU3dpcGVVcDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgICBAT3V0cHV0KCkgb25Td2lwZURvd246IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gICAgQE91dHB1dCgpIG9uU3dpcGU6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gICAgQE91dHB1dCgpIG9uU3dpcGVTdGFydDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgICBAT3V0cHV0KCkgb25Td2lwZUVuZDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgICBAT3V0cHV0KCkgc3dpcGVMZWZ0OiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICAgIEBPdXRwdXQoKSBzd2lwZVJpZ2h0OiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHByaXZhdGUgZWw6IEVsZW1lbnRSZWYsXG4gICAgICAgIHByaXZhdGUgcmVuZGVyZXI6IFJlbmRlcmVyMlxuICAgICkgeyB9XG5cblxuICAgIG5nT25Jbml0KCkge1xuICAgIH1cblxuICAgIGdldFJlc3VsdEZyb21FdmVudChldmVudCkge1xuICAgICAgbGV0IHN3aXBlRnJhbWVEaXN0YW5jZVggPSBldmVudC5jbGllbnRYIC0gdGhpcy5pbml0aWFsUG9zWCAtIHRoaXMubGFzdFBvc1g7XG4gICAgICBzd2lwZUZyYW1lRGlzdGFuY2VYID0gc3dpcGVGcmFtZURpc3RhbmNlWCA8IDMwID8gc3dpcGVGcmFtZURpc3RhbmNlWCA6IDMwO1xuICAgICAgdGhpcy5zd2lwZURpc3RhbmNlWCArPSBzd2lwZUZyYW1lRGlzdGFuY2VYO1xuXG4gICAgICBsZXQgc3dpcGVGcmFtZURpc3RhbmNlWSA9IGV2ZW50LmNsaWVudFkgLSB0aGlzLmluaXRpYWxQb3NZIC0gdGhpcy5sYXN0UG9zWTtcbiAgICAgIHN3aXBlRnJhbWVEaXN0YW5jZVkgPSBzd2lwZUZyYW1lRGlzdGFuY2VZIDwgMzAgPyBzd2lwZUZyYW1lRGlzdGFuY2VZIDogMzA7XG4gICAgICB0aGlzLnN3aXBlRGlzdGFuY2VZICs9IHN3aXBlRnJhbWVEaXN0YW5jZVk7XG5cbiAgICAgIHRoaXMubGFzdFBvc1ggPSBldmVudC5jbGllbnRYIC0gdGhpcy5pbml0aWFsUG9zWDtcbiAgICAgIHRoaXMubGFzdFBvc1kgPSBldmVudC5jbGllbnRZIC0gdGhpcy5pbml0aWFsUG9zWTtcblxuICAgICAgY29uc3QgcmVzID0ge1xuICAgICAgICB2ZWxvY2l0eVg6IHN3aXBlRnJhbWVEaXN0YW5jZVgsXG4gICAgICAgIHZlbG9jaXR5WTogc3dpcGVGcmFtZURpc3RhbmNlWSxcbiAgICAgICAgaXNGaW5hbDogZmFsc2UsXG4gICAgICAgIGRpcmVjdGlvbjogdGhpcy5kaXJlY3Rpb24sXG4gICAgICAgIGV2ZW50OiBldmVudCxcbiAgICAgIH07XG4gICAgICByZXR1cm4gcmVzO1xuICAgIH1cblxuICAgIHN3aXBlU3RhcnQoZXZlbnQpIHtcbiAgICAgIHRoaXMuZmlyc3RTd2lwZURhdGUgPSBEYXRlLm5vdygpO1xuICAgICAgdGhpcy5pc0Rvd24gPSB0cnVlO1xuICAgICAgdGhpcy5pbml0aWFsUG9zWCA9IGV2ZW50LmNsaWVudFg7XG4gICAgICB0aGlzLmluaXRpYWxQb3NZID0gZXZlbnQuY2xpZW50WTtcbiAgICAgIHRoaXMuc3dpcGVEaXN0YW5jZVggPSBaRVJPO1xuICAgICAgdGhpcy5zd2lwZURpc3RhbmNlWSA9IFpFUk87XG4gICAgICB0aGlzLm9uU3dpcGVTdGFydC5lbWl0KCk7XG4gICAgfVxuXG4gICAgc3dpcGVFbmQoZXZlbnQpIHtcbiAgICAgIHRoaXMuaW5pdGlhbFBvc1ggPSB0aGlzLmxhc3RQb3NYID0gWkVSTztcbiAgICAgIHRoaXMuaW5pdGlhbFBvc1kgPSB0aGlzLmxhc3RQb3NZID0gWkVSTztcbiAgICAgIHRoaXMuaXNEb3duID0gZmFsc2U7XG4gICAgICBjb25zdCByZXMgPSB7XG4gICAgICAgIHZlbG9jaXR5WDogMCxcbiAgICAgICAgdmVsb2NpdHlZOiAwLFxuICAgICAgICBpc0ZpbmFsOiAhdGhpcy5pc0Rvd24sXG4gICAgICB9O1xuICAgICAgdGhpcy5vblN3aXBlRW5kLmVtaXQocmVzKTtcbiAgICAgIHRoaXMuc3dpcGVEaXN0YW5jZVggPSBaRVJPO1xuICAgICAgdGhpcy5zd2lwZURpc3RhbmNlWSA9IFpFUk87XG4gICAgfVxuXG4gICAgc3dpcGVNb3ZlKGV2ZW50KSB7XG4gICAgICBjb25zdCByZXMgPSB0aGlzLmdldFJlc3VsdEZyb21FdmVudChldmVudCk7XG4gICAgICBpZiAocmVzLnZlbG9jaXR5WCA+IDApIHtcbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSBESVJFQ1RJT04uTEVGVDtcbiAgICAgICAgdGhpcy5vblN3aXBlTGVmdC5lbWl0KHJlcyk7XG4gICAgICB9IGVsc2UgaWYgKHJlcy52ZWxvY2l0eVggPCAwKSB7XG4gICAgICAgIHRoaXMuZGlyZWN0aW9uID0gRElSRUNUSU9OLlJJR0hUO1xuICAgICAgICB0aGlzLm9uU3dpcGVSaWdodC5lbWl0KHJlcyk7XG4gICAgICB9IGVsc2UgaWYgKHJlcy52ZWxvY2l0eVkgPiAwKSB7XG4gICAgICAgIHRoaXMuZGlyZWN0aW9uID0gRElSRUNUSU9OLkRPV047XG4gICAgICAgIHRoaXMub25Td2lwZURvd24uZW1pdChyZXMpO1xuICAgICAgfSBlbHNlIGlmIChyZXMudmVsb2NpdHlZIDwgMCkge1xuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IERJUkVDVElPTi5VUDtcbiAgICAgICAgdGhpcy5vblN3aXBlVXAuZW1pdChyZXMpO1xuICAgICAgfVxuICAgICAgdGhpcy5vblN3aXBlLmVtaXQocmVzKTtcbiAgICB9XG5cbiAgICBASG9zdExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgWyckZXZlbnQnXSlcbiAgICBvblRvdWNoU3RhcnQoZXZlbnQ6IGFueSkge1xuICAgICAgICBjb25zdCB0b3VjaCA9IGV2ZW50LnRvdWNoZXNbMF0gfHwgZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF07XG4gICAgICAgIHRoaXMuc3dpcGVTdGFydCh0b3VjaCk7XG4gICAgfVxuXG4gICAgQEhvc3RMaXN0ZW5lcignbW91c2Vkb3duJywgWyckZXZlbnQnXSlcbiAgICBvbk1vdXNlRG93bihldmVudDogYW55KSB7XG4gICAgICAgIHRoaXMuc3dpcGVTdGFydChldmVudCk7XG4gICAgfVxuXG4gICAgQEhvc3RMaXN0ZW5lcignZG9jdW1lbnQ6bW91c2V1cCcsIFsnJGV2ZW50J10pXG4gICAgb25Nb3VzZVVwKGV2ZW50OiBhbnkpIHtcbiAgICAgIHRoaXMuc3dpcGVFbmQoZXZlbnQpO1xuICAgIH1cblxuICAgIEBIb3N0TGlzdGVuZXIoJ3RvdWNoZW5kJywgWyckZXZlbnQnXSlcbiAgICBvblRvdWNoRW5kKGV2ZW50OiBhbnkpIHtcbiAgICAgIGNvbnN0IHRvdWNoID0gZXZlbnQudG91Y2hlc1swXSB8fCBldmVudC5jaGFuZ2VkVG91Y2hlc1swXTtcbiAgICAgIHRoaXMuc3dpcGVFbmQodG91Y2gpO1xuICAgIH1cblxuICAgIEBIb3N0TGlzdGVuZXIoJ21vdXNlbW92ZScsIFsnJGV2ZW50J10pXG4gICAgb25Nb3VzZU1vdmUoZXZlbnQ6IGFueSkge1xuICAgICAgaWYgKHRoaXMuaXNEb3duKSB7XG4gICAgICAgIHRoaXMuc3dpcGVNb3ZlKGV2ZW50KTtcbiAgICAgIH1cblxuICAgIH1cblxuICAgIEBIb3N0TGlzdGVuZXIoJ3RvdWNobW92ZScsIFsnJGV2ZW50J10pXG4gICAgb25Ub3VjaE1vdmUoZXZlbnQ6IGFueSkge1xuICAgICAgY29uc3QgdG91Y2ggPSBldmVudC50b3VjaGVzWzBdIHx8IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdO1xuICAgICAgdGhpcy5zd2lwZU1vdmUodG91Y2gpO1xuICAgIH1cblxuXG5cblxufVxuIl19